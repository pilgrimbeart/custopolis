import{g as C,b as a,l as w,c as E,s as i,r,o as g,a as x}from"./session-CTnS1zJP.js";const n=C(),S=a("session-id"),c=a("session-phase"),v=a("mobile-url"),p=a("new-session"),d=a("copy-mobile"),y=Array.from(document.querySelectorAll("[data-phase]")),h=a("start-round"),B="https://pilgrimbeart.github.io/custopolis/",U=t=>t.endsWith("/")?t:`${t}/`,L=U(B),m=new URL("mobile/",L).toString();v.textContent=m;let u=null,s=null,b=null,l=null;const $=async t=>{if(!s)return;const e=[];e.push(i(r(n,`sessions/${s}/phase`),t)),t!=="round"&&(e.push(i(r(n,`sessions/${s}/currentRound`),null)),e.push(i(r(n,`sessions/${s}/roundStartedAt`),null))),await Promise.all(e)},f=()=>{h.disabled=!(s&&b==="round"&&l)},R=t=>{s=t,S.textContent=t??"Not set",c.textContent="-",f(),u&&(u(),u=null),t&&(u=g(r(n,`sessions/${t}`),e=>{const o=e.val();c.textContent=o?.phase??"-"}))};w(n,R);p.addEventListener("click",async()=>{p.disabled=!0;try{await E(n)}catch(t){console.error(t),c.textContent="Error creating session"}finally{p.disabled=!1}});d.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(m),d.textContent="Copied!",window.setTimeout(()=>{d.textContent="Copy mobile URL"},1500)}catch(t){console.error(t),d.textContent="Copy failed"}});y.forEach(t=>{t.addEventListener("click",async()=>{const e=t.dataset.phase;if(e){b=e,l=e==="round"?Number(t.dataset.round):null,y.forEach(o=>o.classList.toggle("active",o===t)),f(),t.disabled=!0;try{await $(e),e==="round"&&l&&await i(r(n,`sessions/${s}/currentRound`),l)}catch(o){console.error(o),c.textContent="Error setting phase"}finally{t.disabled=!1}}})});h.addEventListener("click",async()=>{if(!(!s||b!=="round"||!l)){h.disabled=!0;try{await Promise.all([i(r(n,`sessions/${s}/roundStartedAt`),x())])}catch(t){console.error(t),c.textContent="Error starting round"}finally{f()}}});
