import{r as p,e as Y,f as z,s as W,a as B,h as G,T as D,g as H,b as a,l as j,o as L,C as A,d as K,R as O}from"./session-CTnS1zJP.js";import{_ as J,a as Q,b as X,c as Z,d as tt,e as et,f as st,g as ot,h as nt,i as at,j as rt,k as ct,l as it,m as mt,n as lt,o as _t,p as ut,q as dt,r as gt,s as pt,t as bt,u as ft,v as vt,w as Et,x as yt}from"./customer_image_25-JbvhzYdF.js";const M="custopolis-player-id",St=()=>{const t=localStorage.getItem(M);if(t)return t;const e=crypto.randomUUID();return localStorage.setItem(M,e),e},Ct=t=>{const e=G();if(!t||typeof t!="object")return e;const s=t;for(let o=0;o<D;o+=1){const n=o.toString();typeof s[n]=="number"&&Number.isFinite(s[n])&&(e[n]=s[n])}return e},ht=t=>{let e=0,s=Number.POSITIVE_INFINITY;for(let o=0;o<D;o+=1){const n=t[o.toString()]??0;n<s&&(s=n,e=o)}return e},Tt=async(t,e,s)=>{const o=p(t,`sessions/${e}/players/${s}`),n=await Y(o);if(n.exists()&&typeof n.val()?.teamId=="number")return n.val().teamId;let r=null;const f=p(t,`sessions/${e}/teamCounts`);if(!(await z(f,V=>{const v=Ct(V);return r=ht(v),v[r.toString()]+=1,v})).committed||r===null)throw new Error("Team assignment transaction failed");return await W(o,{teamId:r,joinedAt:B()}),r},i=H(),Rt=a("session-id"),E=a("team-id"),It=a("status"),T=a("app"),R=a("ready-screen"),xt=a("ready-text"),I=a("round-screen"),wt=a("round-title"),$=a("round-clock"),U=a("customer-list"),Lt=a("action-educate"),At=a("action-offer"),Ot=a("action-fix");let y=null,l=null,m=null,c="-",N="-",_=null,u=null,d=null,q=0,x=null,S=null;const k=Array.from({length:25},(t,e)=>new URL(Object.assign({"../common/assets/customer_image_01.png":yt,"../common/assets/customer_image_02.png":Et,"../common/assets/customer_image_03.png":vt,"../common/assets/customer_image_04.png":ft,"../common/assets/customer_image_05.png":bt,"../common/assets/customer_image_06.png":pt,"../common/assets/customer_image_07.png":gt,"../common/assets/customer_image_08.png":dt,"../common/assets/customer_image_09.png":ut,"../common/assets/customer_image_10.png":_t,"../common/assets/customer_image_11.png":lt,"../common/assets/customer_image_12.png":mt,"../common/assets/customer_image_13.png":it,"../common/assets/customer_image_14.png":ct,"../common/assets/customer_image_15.png":rt,"../common/assets/customer_image_16.png":at,"../common/assets/customer_image_17.png":nt,"../common/assets/customer_image_18.png":ot,"../common/assets/customer_image_19.png":st,"../common/assets/customer_image_20.png":et,"../common/assets/customer_image_21.png":tt,"../common/assets/customer_image_22.png":Z,"../common/assets/customer_image_23.png":X,"../common/assets/customer_image_24.png":Q,"../common/assets/customer_image_25.png":J})[`../common/assets/customer_image_${String(e+1).padStart(2,"0")}.png`],import.meta.url).toString()),g=t=>{It.textContent=t},F=t=>{const e=K[t]??"#102432";document.documentElement.style.setProperty("--team-color",e),xt.textContent=`TEAM ${t+1} READY`,T.classList.add("hidden"),R.classList.remove("hidden"),I.classList.add("hidden")},Mt=()=>{T.classList.add("hidden"),R.classList.add("hidden"),I.classList.remove("hidden")},C=()=>{T.classList.remove("hidden"),R.classList.add("hidden"),I.classList.add("hidden")},P=t=>{const e=Math.max(0,Math.floor(t/1e3)),s=Math.floor(e/60),o=e%60;return`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},b=()=>{if(!m){$.textContent=P(O*1e3);return}const t=Date.now()+q,e=m+O*1e3-t;$.textContent=P(e)},h=t=>{d&&(window.clearInterval(d),d=null),t&&(b(),d=window.setInterval(b,250))},$t=()=>{c==="round"?(Mt(),h(!!m)):(h(!1),S!==null?F(S):C())},w=()=>{const t=x!==null;Lt.disabled=!t,At.disabled=!t,Ot.disabled=!t},Ut=t=>{U.innerHTML="";const e=t*A;for(let s=0;s<A;s+=1){const o=document.createElement("button");o.type="button",o.className="customer-card";const n=document.createElement("img");n.src=k[e+s]??k[0],n.alt="Customer";const r=document.createElement("span");r.textContent=`Customer ${s+1}`,o.appendChild(n),o.appendChild(r),o.addEventListener("click",()=>{x=s,document.querySelectorAll(".customer-card").forEach(f=>{f.classList.remove("selected")}),o.classList.add("selected"),w()}),U.appendChild(o)}};w();j(i,async t=>{if(Rt.textContent=t??"Waiting...",!t){E.textContent="-",g("Waiting for host to start a cohort."),C(),y=null;return}if(t!==y){y=t,g("Assigning team..."),C();try{const e=St(),s=await Tt(i,t,e);S=s,Ut(s),E.textContent=`Team ${s+1}`,g("Ready"),window.requestAnimationFrame(()=>F(s))}catch(e){console.error(e),E.textContent="-",g("Unable to join session.")}}});j(i,t=>{if(u&&(u(),u=null),_&&(_(),_=null),!t){c="-",l=null,m=null,h(!1);return}u=L(p(i,`sessions/${t}`),e=>{const s=e.val();c=s?.phase??"-",c!==N&&(x=null,document.querySelectorAll(".customer-card").forEach(o=>{o.classList.remove("selected")}),w(),N=c),l=typeof s?.currentRound=="number"?s.currentRound:null,m=typeof s?.roundStartedAt=="number"?s.roundStartedAt:null,wt.textContent=l?`Round ${l}`:"Round",b(),$t()}),_=L(p(i,".info/serverTimeOffset"),e=>{q=typeof e.val()=="number"?e.val():0,b()})});
