import{g as y,b as a,l as C,c as E,o as g,r,s as i,a as w}from"./session-CTnS1zJP.js";const o=y(),x=a("session-id"),c=a("session-phase"),$=a("mobile-url"),b=a("new-session"),d=a("copy-mobile"),p=Array.from(document.querySelectorAll("[data-phase]")),h=a("start-round"),S="https://pilgrimbeart.github.io/custopolis/",v=t=>t.endsWith("/")?t:`${t}/`,B=v(S),f=new URL("mobile/",B).toString();$.textContent=f;let u=null,n=null,l=null;const U=async t=>{if(!n)return;const e=[];e.push(i(r(o,`sessions/${n}/phase`),t));const s=t.match(/^round-(\d+)$/);s&&e.push(i(r(o,`sessions/${n}/roundNumber`),Number(s[1]))),await Promise.all(e)},m=()=>{h.disabled=!(n&&l&&/^round-\d+$/.test(l))},L=t=>{n=t,x.textContent=t??"Not set",c.textContent="-",m(),u&&(u(),u=null),t&&(u=g(r(o,`sessions/${t}`),e=>{const s=e.val();c.textContent=s?.phase??"-"}))};C(o,L);b.addEventListener("click",async()=>{b.disabled=!0;try{await E(o)}catch(t){console.error(t),c.textContent="Error creating session"}finally{b.disabled=!1}});d.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(f),d.textContent="Copied!",window.setTimeout(()=>{d.textContent="Copy mobile URL"},1500)}catch(t){console.error(t),d.textContent="Copy failed"}});p.forEach(t=>{t.addEventListener("click",async()=>{const e=t.dataset.phase;if(e){l=e,p.forEach(s=>s.classList.toggle("active",s===t)),m(),t.disabled=!0;try{await U(e)}catch(s){console.error(s),c.textContent="Error setting phase"}finally{t.disabled=!1}}})});h.addEventListener("click",async()=>{if(!n||!l)return;const t=l.match(/^round-(\d+)$/);if(!t)return;const e=Number(t[1]);h.disabled=!0;try{await Promise.all([i(r(o,`sessions/${n}/currentRound`),e),i(r(o,`sessions/${n}/roundNumber`),e),i(r(o,`sessions/${n}/roundStartedAt`),w())])}catch(s){console.error(s),c.textContent="Error starting round"}finally{m()}});
