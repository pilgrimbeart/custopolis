import{r as y,d as I,e as C,s as b,f as S,h,T as g,g as x,b as o,l as w,a as A}from"./session-UX4NEy02.js";const f="custopolis-player-id",L=()=>{const t=localStorage.getItem(f);if(t)return t;const e=crypto.randomUUID();return localStorage.setItem(f,e),e},R=t=>{const e=h();if(!t||typeof t!="object")return e;const n=t;for(let s=0;s<g;s+=1){const a=s.toString();typeof n[a]=="number"&&Number.isFinite(n[a])&&(e[a]=n[a])}return e},O=t=>{let e=0,n=Number.POSITIVE_INFINITY;for(let s=0;s<g;s+=1){const a=t[s.toString()]??0;a<n&&(n=a,e=s)}return e},v=async(t,e,n)=>{const s=y(t,`sessions/${e}/players/${n}`),a=await I(s);if(a.exists()&&typeof a.val()?.teamId=="number")return a.val().teamId;let r=null;const T=y(t,`sessions/${e}/teamCounts`);if(!(await C(T,E=>{const c=R(E);return r=O(c),c[r.toString()]+=1,c})).committed||r===null)throw new Error("Team assignment transaction failed");return await b(s,{teamId:r,joinedAt:S()}),r},p=x(),N=o("session-id"),l=o("team-id"),$=o("status"),m=o("app"),u=o("ready-screen"),P=o("ready-text");let d=null;const i=t=>{$.textContent=t},U=t=>{const e=A[t]??"#102432";document.documentElement.style.setProperty("--team-color",e),P.textContent=`TEAM ${t+1} READY`,m.classList.add("hidden"),u.classList.remove("hidden")};w(p,async t=>{if(N.textContent=t??"Waiting...",!t){l.textContent="-",i("Waiting for host to start a cohort."),m.classList.remove("hidden"),u.classList.add("hidden"),d=null;return}if(t!==d){d=t,i("Assigning team..."),m.classList.remove("hidden"),u.classList.add("hidden");try{const e=L(),n=await v(p,t,e);l.textContent=`Team ${n+1}`,i("Ready"),window.requestAnimationFrame(()=>U(n))}catch(e){console.error(e),l.textContent="-",i("Unable to join session.")}}});
